<!-- ============================= -->
<!-- SCREENER: OI SECTION -->
<!-- ============================= -->

<section class="screener-section" id="openIntrest">
  <h2 class="section-title">游늵 Open Interest Changes</h2>

  <div class="section-right-control">
    <select id="dateSelect" name="date" onchange="window.location.href='/scanner/top-gainers-losers?date='+this.value;">
      {% for d in dates %}
      <option value="{{ d }}" {% if d==selected_date %}selected{% endif %}>{{ d }}</option>
      {% endfor %}
    </select>

    <!-- PDF Export Button -->
    {% if selected_date and screener_data %}
    <div class="control-group">
      <a href="{{ url_for('gainers_losers.export_screener_pdf', date=selected_date) }}" class="btn-export-pdf"
        title="Download Screener Report as PDF">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Download PDF Report
      </a>
    </div>
    {% endif %}
  </div>
  <div class="cards-grid">
    <!-- CALL OPTIONS - ALL -->
    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游릭 Top 10 Call OI Gainers (All)</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_call_gainers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游댮 Top 10 Call OI Losers (All)</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_call_losers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- CALL OPTIONS - ITM -->
    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游릭 Top 10 ITM Call OI Gainers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_call_itm_gainers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游댮 Top 10 ITM Call OI Losers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_call_itm_losers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- CALL OPTIONS - OTM -->
    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游릭 Top 10 OTM Call OI Gainers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_call_otm_gainers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游댮 Top 10 OTM Call OI Losers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_call_otm_losers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- PUT OPTIONS - ALL -->
    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游릭 Top 10 Put OI Gainers (All)</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_put_gainers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游댮 Top 10 Put OI Losers (All)</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_put_losers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- PUT OPTIONS - ITM -->
    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游릭 Top 10 ITM Put OI Gainers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_put_itm_gainers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游댮 Top 10 ITM Put OI Losers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_put_itm_losers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- PUT OPTIONS - OTM -->
    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游릭 Top 10 OTM Put OI Gainers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_put_otm_gainers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="screener-card">
      <div class="card-header">
        <div class="card-title">游댮 Top 10 OTM Put OI Losers</div>
      </div>
      <table class="card-table sortable-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Symbol</th>
            <th>Strike</th>
            <th>Underlying Price</th>
            <th>OI Change (%)</th>
          </tr>
        </thead>
        <tbody>
          {% for item in screener_data.oi_put_otm_losers %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>
              <a href="/stock/{{ item.ticker }}" class="symbol-link" data-ticker="{{ item.ticker }}"
                data-toggle="tooltip"
                title="{% if ticker_map.get(item.ticker) %}{{ ticker_map[item.ticker] }}{% endif %}">
                {{ item.ticker }}
              </a>
            </td>
            <td>{{ "%.0f" | format(item.strike_price) if item.strike_price else 'N/A' }}</td>
            <td>{{ "%.2f" | format(item.underlying_price) }}</td>
            <td class="{{ 'positive' if item.change >= 0 else 'negative' }}">{{ "%+.2f" | format(item.change) }}%</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
