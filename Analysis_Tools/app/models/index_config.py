# =============================================================
#  INDEX CONFIGURATION
#  Purpose: Defines stock lists for various market indices
#  Used for heatmap filtering by index
#  Now with dynamic index detection based on available stocks
# =============================================================

# =============================================================
# NIFTY 50 STOCKS (as of Jan 2026)
# =============================================================
NIFTY_50 = [
    "ADANIPORTS",
    "APOLLOHOSP",
    "ASIANPAINT",
    "AXISBANK",
    "BAJAJ-AUTO",
    "BAJFINANCE",
    "BAJAJFINSV",
    "BEL",
    "BPCL",
    "BHARTIARTL",
    "BRITANNIA",
    "CIPLA",
    "COALINDIA",
    "DRREDDY",
    "EICHERMOT",
    "ETERNAL",
    "GRASIM",
    "HCLTECH",
    "HDFCBANK",
    "HDFCLIFE",
    "HEROMOTOCO",
    "HINDALCO",
    "HINDUNILVR",
    "ICICIBANK",
    "INDUSINDBK",
    "INFY",
    "ITC",
    "JSWSTEEL",
    "KOTAKBANK",
    "LT",
    "M&M",
    "MARUTI",
    "NESTLEIND",
    "NTPC",
    "ONGC",
    "POWERGRID",
    "RELIANCE",
    "SBILIFE",
    "SHRIRAMFIN",
    "SBIN",
    "SUNPHARMA",
    "TCS",
    "TATACONSUM",
    "TATAMOTORS",
    "TATASTEEL",
    "TECHM",
    "TITAN",
    "TRENT",
    "ULTRACEMCO",
    "WIPRO",
]

# =============================================================
# NIFTY NEXT 50 STOCKS
# =============================================================
NIFTY_NEXT_50 = [
    "ABB",
    "ACC",
    "ADANIENT",
    "AMBUJACEM",
    "AUROPHARMA",
    "BANKBARODA",
    "BOSCHLTD",
    "CANBK",
    "CHOLAFIN",
    "COLPAL",
    "DLF",
    "DABUR",
    "DMART",
    "GODREJCP",
    "GAIL",
    "HAL",
    "HAVELLS",
    "ICICIGI",
    "ICICIPRULI",
    "INDHOTEL",
    "IOC",
    "IRCTC",
    "JINDALSTEL",
    "JIOFIN",
    "JSWENERGY",
    "LICI",
    "LODHA",
    "LTIM",
    "LUPIN",
    "MARICO",
    "MAXHEALTH",
    "NAUKRI",
    "NHPC",
    "PAGEIND",
    "PAYTM",
    "PFC",
    "PIDILITIND",
    "PNB",
    "POLYCAB",
    "RECLTD",
    "SIEMENS",
    "SRF",
    "TATAPOWER",
    "TVSMOTOR",
    "TORNTPHARM",
    "TRENT",
    "UNIONBANK",
    "VEDL",
    "VBL",
    "ZOMATO",
]

# =============================================================
# NIFTY BANK STOCKS
# =============================================================
NIFTY_BANK = [
    "AUBANK",
    "AXISBANK",
    "BANDHANBNK",
    "BANKBARODA",
    "FEDERALBNK",
    "HDFCBANK",
    "ICICIBANK",
    "IDFCFIRSTB",
    "INDUSINDBK",
    "KOTAKBANK",
    "PNB",
    "SBIN",
]

# =============================================================
# NIFTY IT STOCKS
# =============================================================
NIFTY_IT = ["COFORGE", "HCLTECH", "INFY", "LTIM", "LTTS", "MPHASIS", "PERSISTENT", "TCS", "TECHM", "WIPRO"]

# =============================================================
# NIFTY PHARMA STOCKS
# =============================================================
NIFTY_PHARMA = [
    "ALKEM",
    "APOLLOHOSP",
    "AUROPHARMA",
    "BIOCON",
    "CIPLA",
    "DIVISLAB",
    "DRREDDY",
    "GLAND",
    "GLENMARK",
    "LAURUSLABS",
    "LUPIN",
    "SUNPHARMA",
    "TORNTPHARM",
    "ZYDUSLIFE",
]

# =============================================================
# NIFTY AUTO STOCKS
# =============================================================
NIFTY_AUTO = [
    "APOLLOTYRE",
    "ASHOKLEY",
    "BAJAJ-AUTO",
    "BALKRISIND",
    "BHARATFORG",
    "BOSCHLTD",
    "EICHERMOT",
    "EXIDEIND",
    "HEROMOTOCO",
    "M&M",
    "MARUTI",
    "MRF",
    "MOTHERSON",
    "TATAMOTORS",
    "TVSMOTOR",
]

# =============================================================
# NIFTY METAL STOCKS
# =============================================================
NIFTY_METAL = [
    "ADANIENT",
    "APL",
    "COALINDIA",
    "HINDALCO",
    "HINDCOPPER",
    "JINDALSTEL",
    "JSWSTEEL",
    "NATIONALUM",
    "NMDC",
    "RATNAMANI",
    "SAIL",
    "TATASTEEL",
    "VEDL",
    "WELCORP",
]

# =============================================================
# NIFTY FMCG STOCKS
# =============================================================
NIFTY_FMCG = [
    "BRITANNIA",
    "COLPAL",
    "DABUR",
    "EMAMILTD",
    "GODREJCP",
    "HINDUNILVR",
    "ITC",
    "MARICO",
    "NESTLEIND",
    "PGHH",
    "RADICO",
    "TATACONSUM",
    "UBL",
    "VBL",
    "ZYDUSWELL",
]

# =============================================================
# NIFTY ENERGY STOCKS
# =============================================================
NIFTY_ENERGY = [
    "ADANIGREEN",
    "BPCL",
    "COALINDIA",
    "GAIL",
    "HINDPETRO",
    "IOC",
    "NTPC",
    "ONGC",
    "POWERGRID",
    "RELIANCE",
    "TATAPOWER",
    "ADANIENSOL",
]

# =============================================================
# NIFTY PSU BANK STOCKS
# =============================================================
NIFTY_PSU_BANK = [
    "BANKBARODA",
    "BANKINDIA",
    "CANBK",
    "CENTRALBK",
    "INDIANB",
    "IOB",
    "MAHABANK",
    "PNB",
    "PSB",
    "SBIN",
    "UCOBANK",
    "UNIONBANK",
]

# =============================================================
# NIFTY FINANCIAL SERVICES STOCKS
# =============================================================
NIFTY_FINANCIAL = [
    "AXISBANK",
    "BAJAJFINSV",
    "BAJFINANCE",
    "CHOLAFIN",
    "HDFCAMC",
    "HDFCBANK",
    "HDFCLIFE",
    "ICICIBANK",
    "ICICIGI",
    "ICICIPRULI",
    "KOTAKBANK",
    "LICHSGFIN",
    "M&MFIN",
    "MUTHOOTFIN",
    "PFC",
    "RECLTD",
    "SBICARD",
    "SBILIFE",
    "SBIN",
    "SHRIRAMFIN",
    "AUBANK",
    "ABCAPITAL",
    "ANGELONE",
    "360ONE",
]

# =============================================================
# SENSEX STOCKS (BSE 30)
# =============================================================
SENSEX = [
    "ASIANPAINT",
    "AXISBANK",
    "BAJAJ-AUTO",
    "BAJFINANCE",
    "BHARTIARTL",
    "HCLTECH",
    "HDFCBANK",
    "HEROMOTOCO",
    "HINDUNILVR",
    "ICICIBANK",
    "INDUSINDBK",
    "INFY",
    "ITC",
    "JSWSTEEL",
    "KOTAKBANK",
    "LT",
    "M&M",
    "MARUTI",
    "NESTLEIND",
    "NTPC",
    "POWERGRID",
    "RELIANCE",
    "SBIN",
    "SUNPHARMA",
    "TATAMOTORS",
    "TATASTEEL",
    "TCS",
    "TECHM",
    "TITAN",
    "ULTRACEMCO",
]

# =============================================================
# INDEX DEFINITIONS
# =============================================================
INDEX_DEFINITIONS = {
    "all": {"name": "All F&O Stocks", "description": "All stocks with F&O trading", "stocks": None, "icon": "ğŸ“Š"},
    "nifty50": {"name": "Nifty 50", "description": "Top 50 companies by market cap", "stocks": NIFTY_50, "icon": "ğŸ†"},
    "niftynext50": {
        "name": "Nifty Next 50",
        "description": "Next 50 companies after Nifty 50",
        "stocks": NIFTY_NEXT_50,
        "icon": "ğŸ“ˆ",
    },
    "niftybank": {"name": "Nifty Bank", "description": "Banking sector stocks", "stocks": NIFTY_BANK, "icon": "ğŸ¦"},
    "niftyit": {"name": "Nifty IT", "description": "Information Technology stocks", "stocks": NIFTY_IT, "icon": "ğŸ’»"},
    "niftypharma": {
        "name": "Nifty Pharma",
        "description": "Pharmaceutical stocks",
        "stocks": NIFTY_PHARMA,
        "icon": "ğŸ’Š",
    },
    "niftyauto": {"name": "Nifty Auto", "description": "Automobile sector stocks", "stocks": NIFTY_AUTO, "icon": "ğŸš—"},
    "niftymetal": {"name": "Nifty Metal", "description": "Metal & Mining stocks", "stocks": NIFTY_METAL, "icon": "âš™ï¸"},
    "niftyfmcg": {"name": "Nifty FMCG", "description": "Fast Moving Consumer Goods", "stocks": NIFTY_FMCG, "icon": "ğŸ›’"},
    "niftyenergy": {
        "name": "Nifty Energy",
        "description": "Energy & Power stocks",
        "stocks": NIFTY_ENERGY,
        "icon": "âš¡",
    },
    "niftypsubank": {
        "name": "Nifty PSU Bank",
        "description": "Public Sector Banks",
        "stocks": NIFTY_PSU_BANK,
        "icon": "ğŸ›ï¸",
    },
    "niftyfinancial": {
        "name": "Nifty Financial",
        "description": "Financial Services stocks",
        "stocks": NIFTY_FINANCIAL,
        "icon": "ğŸ’°",
    },
    "sensex": {"name": "Sensex", "description": "BSE Top 30 companies", "stocks": SENSEX, "icon": "ğŸ¯"},
}


def get_index_list():
    """Return list of available indices for dropdown."""
    return [{"key": key, "name": val["name"], "icon": val["icon"]} for key, val in INDEX_DEFINITIONS.items()]


def get_index_stocks(index_key: str) -> list:
    """
    Get list of stocks for a specific index.
    Returns None if index_key is 'all' (means no filter).
    """
    if index_key not in INDEX_DEFINITIONS:
        return None

    return INDEX_DEFINITIONS[index_key]["stocks"]


def get_index_info(index_key: str) -> dict:
    """Get information about an index."""
    return INDEX_DEFINITIONS.get(index_key, INDEX_DEFINITIONS["all"])


def filter_stocks_by_index(stocks: list, index_key: str) -> list:
    """
    Filter a list of stock dicts by index.
    Expects stocks to have 'symbol' key.
    """
    index_stocks = get_index_stocks(index_key)

    if index_stocks is None:
        return stocks  # No filter for 'all'

    # Normalize index stocks to uppercase
    index_stocks_upper = set(s.upper() for s in index_stocks)

    return [stock for stock in stocks if stock.get("symbol", "").upper() in index_stocks_upper]


def get_dynamic_indices(available_symbols: list) -> list:
    """
    Get list of indices with count of matching stocks from available_symbols.
    Only returns indices that have at least 1 matching stock.
    """
    if not available_symbols:
        return [{"key": "all", "name": "All F&O Stocks", "icon": "ğŸ“Š", "count": 0}]

    available_upper = set(s.upper() for s in available_symbols)

    result = []
    for key, val in INDEX_DEFINITIONS.items():
        if val["stocks"] is None:
            # "all" index always first
            result.insert(0, {"key": key, "name": val["name"], "icon": val["icon"], "count": len(available_symbols)})
        else:
            # Count matching stocks
            index_upper = set(s.upper() for s in val["stocks"])
            match_count = len(available_upper & index_upper)
            if match_count > 0:
                result.append(
                    {"key": key, "name": f"{val['name']} ({match_count})", "icon": val["icon"], "count": match_count}
                )

    # Sort by count (descending) but keep 'all' first
    if len(result) > 1:
        all_idx = result[0]
        rest = sorted(result[1:], key=lambda x: x["count"], reverse=True)
        result = [all_idx] + rest

    return result
