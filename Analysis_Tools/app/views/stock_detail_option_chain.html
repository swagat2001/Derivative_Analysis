<!-- ==============================
     STOCK DETAIL OPTION CHAIN COMPONENT
     ============================== -->
<div class="option-chain-section">
    <h3 class="section-title">ðŸ”— Option Chain</h3>
    {% if data %}
    <div class="table-scroll-container">
        <table class="option-chain-table" id="optionChainTable">
            <thead>
                <tr>
                    <th rowspan="2">Date</th>
                    <th rowspan="2">Expiry</th>
                    <th rowspan="2">Strike</th>
                    <th rowspan="2">Type</th>
                    <th colspan="5" class="current-header">Current Data</th>
                    <th colspan="5" class="greek-header">Greeks</th>
                    <th colspan="4" class="prev-header">Previous Day</th>
                </tr>
                <tr>
                    <!-- Current Data -->
                    <th>OI</th>
                    <th>OI Chg</th>
                    <th>Volume</th>
                    <th>Close</th>
                    <th>Underlying</th>
                    <!-- Greeks -->
                    <th class="greek-col">IV %</th>
                    <th class="greek-col">Delta</th>
                    <th class="greek-col">Vega</th>
                    <th class="greek-col">Gamma</th>
                    <th class="greek-col">Theta</th>
                    <!-- Previous Day -->
                    <th class="prev-col">Prev OI</th>
                    <th class="prev-col">OI Chg %</th>
                    <th class="prev-col">Prev Price</th>
                    <th class="prev-col">Price Chg %</th>
                </tr>
            </thead>
            <tbody>
                {% for row in data %}
                <tr class="{% if row.OptnTp == 'CE' %}call-row{% else %}put-row{% endif %}">
                    <td>{{ row.BizDt }}</td>
                    <td>{{ row.FininstrmActlXpryDt }}</td>
                    <td class="strike-cell">{{ "%.2f"|format(row.StrkPric) }}</td>
                    <td class="{% if row.OptnTp == 'CE' %}call-type{% else %}put-type{% endif %}">
                        {{ row.OptnTp }}
                    </td>
                    <!-- Current Data -->
                    <td class="num-cell">{{ "{:,.0f}".format(row.OpnIntrst) }}</td>
                    <td class="num-cell">{{ "{:,.0f}".format(row.ChngInOpnIntrst) }}</td>
                    <td class="num-cell">{{ "{:,.0f}".format(row.TtlTradgVol) }}</td>
                    <td class="num-cell">{{ "%.2f"|format(row.ClsPric) }}</td>
                    <td class="num-cell">{{ "%.2f"|format(row.UndrlygPric) }}</td>
                    <!-- Greeks -->
                    
                    <td class="greek-cell">{{ "%.4f"|format(row.Delta) if row.Delta is not none else '' }}</td>
                    <td class="greek-cell">{{ "%.4f"|format(row.Vega) if row.Vega is not none else '' }}</td>
                    <td class="greek-cell">{{ "%.6f"|format(row.Gamma) if row.Gamma is not none else '' }}</td>
                    <td class="greek-cell">{{ "%.6f"|format(row.Theta) if row.Theta is not none else '' }}</td>
                    <td class="greek-cell">{{ "%.2f"|format(row.IV) if row.IV is not none else '' }}</td>

                    <!-- Previous Day -->
                    <td class="prev-cell">{% if row.PrevOI %}{{ "{:,.0f}".format(row.PrevOI) }}{% else %}-{% endif %}</td>
                    <td class="prev-cell 
                        {% if row['OI_Chg_%'] is not none %}
                            {% if row['OI_Chg_%'] > 0 %}positive
                            {% elif row['OI_Chg_%'] < 0 %}negative
                            {% endif %}
                        {% endif %}">
                        {{ "%.2f"|format(row['OI_Chg_%']) if row['OI_Chg_%'] is not none else '' }}
                    </td>

                    <td class="prev-cell">{% if row.PrevPrice %}{{ "%.2f"|format(row.PrevPrice) }}{% else %}-{% endif %}</td>
                    <td class="prev-cell 
                        {% if row['Price_Chg_%'] is not none %}
                            {% if row['Price_Chg_%'] > 0 %}positive
                            {% elif row['Price_Chg_%'] < 0 %}negative
                            {% endif %}
                        {% endif %}">
                        {{ "%.2f"|format(row['Price_Chg_%']) if row['Price_Chg_%'] is not none else '' }}
                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="no-data-message">No option chain data available</p>
    {% endif %}
</div>